@PACK_FIRST_LOAD
PACK_USED = 0
PACK_MAX = 100

;①获得物品
;判断物品数量情况
@ITEM_GAIN_ENABLE()
#FUNCTION
SIF PACK_USED < PACK_MAX
	RETURNF 1
SIF PACK_USED == PACK_MAX
	RETURNF 0
SIF PACK_USED > PACK_MAX
	RETURNF -1
;判断是否已有物品
@ITEM_GAIN_OWNED(ARG)
#FUNCTION
#DIM PACK_ID
FOR LOCAL,1,PACK_MAX
IF PACK_USE:LOCAL:1 == ARG
	RETURNF LOCAL
ELSE
ENDIF
NEXT
RETURNF 0

;物品添加
;		  物品id 数量 获得方式
@ITEM_GAIN,ARG:0,ARG:1,ARGS
#DIM ITEM_ID
#DIM PACK_ID
#DIM ITEM_NUM
#DIMS ITEM_STYLE
ITEM_ID  = ARG:0
ITEM_NUM = ARG:1
SIF ITEM_INFO:ITEM_ID:0 >= 10
	ITEM_STYLE = 物品
SIF ITEM_INFO:ITEM_ID:0 < 10
	ITEM_STYLE = 装备
;获得类型
SELECTCASE ARGS
	CASE "商店"
		
	CASE "怪物掉落"
		LOCALS = 怪物掉落
	CASE "系统奖励"
		LOCALS = 系统奖励
	CASE "其他"
		
	CASEELSE
ENDSELECT

;背包是否能获得物品
;		背包未满		或		               背包已有该类物品并且背包已满并且不是装备类
IF ITEM_GAIN_ENABLE() > 0 || (ITEM_GAIN_OWNED(ITEM_ID) == 1 && ITEM_GAIN_ENABLE() == 0 && ITEM_INFO:ITEM_ID:0 >= 10)
	PRINTFORML 获得%LOCALS%%ITEM_STYLE%%ISTR:ITEM_ID:0%X{ITEM_NUM}
	TWAIT 800,1
	CLEARLINE 1
;			背包未有该类物品并且背包已满
ELSEIF ITEM_GAIN_OWNED(ITEM_ID) == 0 && ITEM_GAIN_ENABLE() == 0
	PRINTW 背包已满
	CLEARLINE 1
	RETURN
ELSE
	PRINTW 数据异常,请重启游戏
	INPUT
ENDIF

IF ITEM_STYLE == "装备"
	;空背包ID存储
	PACK_USE:PACK_CHECK_ID():1  = ITEM_ID
	PACK_ID = PACK_CHECK_ID()
	;背包物品数量计入
	PACK_USE:PACK_CHECK_ID():2 += 1
	;背包已使用+1
	PACK_USED += 1
	;装备属性赋予
	CALL EQUIP_BASE_ADD,PACK_ID
ELSEIF ITEM_STYLE == "物品"
	IF ITEM_GAIN_OWNED(ITEM_ID) != 0
		PACK_USE:ITEM_GAIN_OWNED(ITEM_ID):2 += ITEM_NUM
	ELSE
		PACK_USE:PACK_CHECK_ID():1  = ITEM_ID
		PACK_USE:PACK_CHECK_ID():2 += ITEM_NUM
		PACK_USED += 1
	ENDIF
ELSE
ENDIF

;空背包ID检索
@PACK_CHECK_ID()
#FUNCTION
FOR LOCAL,1,PACK_MAX+1
	SIF PACK_USE:LOCAL:2 == 0
		RETURNF LOCAL
NEXT

;②删除物品


;			背包ID,数量  类型
@ITEM_REMOVE,ARG:0,ARG:1,ARGS
#DIM PACK_ID
#DIM ITEM_NUM
;删除物品类型
SELECTCASE ARGS
	CASE "贩卖"
		LOCALS = "成功贩卖物品"
	CASE "丢弃"
		LOCALS = "成功丢弃物品"
	CASE "任务"
		LOCALS = "成功提交任务物品"
	CASE "装备替换"
		
	CASEELSE
ENDSELECT

PACK_ID  = ARG:0
ITEM_NUM = ARG:1

;删除物品判断
IF ITEM_NUM > PACK_USE:PACK_ID:2 && ARGS != "装备替换"
	PRINTW 输入数量错误!
	RETURN
ELSEIF ITEM_NUM > PACK_USE:PACK_ID:2 && ARGS == "装备替换"
	PRINTW 未知错误
	RETURN
ELSEIF ITEM_NUM == PACK_USE:PACK_ID:2
	FOR LOCAL,1,11
		ITEM_BASE:PACK_ID:LOCAL = 0
	NEXT
	PACK_USE:PACK_ID:2 = 0
	PACK_USE:PACK_ID:1 = 0
	PACK_USED -= 1
	CALL SORT_ITEM,PACK_ID
ELSE
	PACK_USE:PACK_ID:2 -= ITEM_NUM
ENDIF
SIF ARGS != "装备替换"
	PRINTFORML %LOCALS%%ISTR:PACK_ID:0%X{ITEM_NUM}
TWAIT 200,1


@SORT_ITEM,ARG
#DIM PACK_REMOVE_ID
PACK_REMOVE_ID = ARG
FOR LOCAL,PACK_REMOVE_ID,PACK_USED+2
	PACK_USE:LOCAL:1 = PACK_USE:(LOCAL+1):1
	PACK_USE:LOCAL:2 = PACK_USE:(LOCAL+1):2
NEXT

;③索引物品
@PACK_ID_FIND(ARG)
#FUNCTION
FOR LOCAL,1,PACK_MAX+1
	SIF PACK_USE:LOCAL:1 == ARG
		RETURNF LOCAL
	RETURNF 0
NEXT











