



;#####更换装备显示#####
;E_SHOCK:	1	 2      3       4      5,6	  7      8,9   10     11      12,13	
;ARG 	1.头盔,2.项链,3.披风,4.盔甲,5.武器,6.腰带,7.戒指,8.护腕,9.靴子,10.挂件
@EQUIP_MAIN,ARG
#DIM NUM
#DIM NEEDLEVEL
#DIM PAGENUM
;当前装备孔E_SHOCK
#DIM E_SHOCK
LIST_E:0 =0
LOCAL:1 = 1
ARG -= 210
E_SHOCK = ARG
$E_001
PAGENUM = 1
PRINTFORML 
PRINTFORML 
DRAWLINE
PRINTFORML \@EQUIP:E_SHOCK == 0?  #当前装备:\@
PRINTFORM \@EQUIP:E_SHOCK == 0? 无装备#%ITEM_NAME:(EQUIP:E_SHOCK)%\@     
IF EQUIP:E_SHOCK != 0
	PRINTFORM 装备等级LV{ITEM_INFO:(EQUIP:E_SHOCK):0,3,LEFT}
	FOR LOCAL,1,6
	SELECTCASE ITEM_INFO:(EQUIP:E_SHOCK):LOCAL
		CASE 0
			CONTINUE
		CASE 1 TO 5
			PRINTFORM %ISTR:LOCAL%+{ITEM_INFO:(EQUIP:E_SHOCK):LOCAL} 
		CASEELSE
			ENDSELECT
	NEXT
ELSE
	PRINTL 
ENDIF
PRINTFORML 
DRAWLINE
DRAWLINE
PRINTL 装备更换
DRAWLINE
LOCAL:2 = LOCAL:1 + 20
FOR LOCAL,LOCAL:1,LOCAL:2
	;装备孔转化成装备类型
	IF ARG == 6
		ARG = 5
	ELSEIF ARG == 7
		ARG = 6
	ELSEIF ARG == 9 || ARG == 8
		ARG = 7
	ELSEIF ARG == 10
		ARG = 8
	ELSEIF ARG == 11
		ARG = 9
	ELSEIF ARG == 12 || ARG == 13
		ARG = 10
	ELSE
	ENDIF
	;装备需求等级
	NEEDLEVEL = ITEM_INFO:(ITEM_OWN:LOCAL:1):0
	;显示条件(ITEM:LOCAL:NUM为当前检索物品id)：
	;	一页显示20项,    	高于装备需求等级,			对应装备槽的装备类型,			背包栏该物品的数量不为0
	IF PAGENUM <= 20 && BASE:0:等级 >= NEEDLEVEL && ITEM_INFO:(ITEM_OWN:LOCAL:1):10 == ARG && ITEM_OWN:LOCAL:2 > 0
		PRINTFORM [{PAGENUM,2,RIGHT}]%ITEM_NAME:(ITEM_OWN:LOCAL:1),18,LEFT%
		PRINTFORM 装备LV{ITEM_INFO:(ITEM_OWN:LOCAL:1):0,3,LEFT}
		FOR NUM,1,6
				SELECTCASE ITEM_INFO:(ITEM_OWN:LOCAL:1):NUM
					CASE 0
						CONTINUE
					CASE 1 TO 5
						PRINTFORM %ISTR:NUM%+{ITEM_INFO:(ITEM_OWN:LOCAL:1):NUM} 
						;储存当前列表的物品id
						LIST_E:PAGENUM = ITEM_OWN:LOCAL:1
					CASEELSE
				ENDSELECT
			NEXT
		PRINTFORM 数量:{ITEM_OWN:LOCAL:2}
		PRINTL
		LIST_E:0 += 1
		PAGENUM += 1
	ELSEIF PAGENUM <= 20 && ITEM_OWN:LOCAL:2 == 0
		PRINTFORML 
		PAGENUM += 1
	ENDIF
NEXT
DRAWLINE
PRINTFORML 
PRINTL [300]取下当前装备
DRAWLINE
PRINT [201]上一页
PRINT      
PRINTL [202]下一页
DRAWLINE
PRINTL [000]返回

INPUT
CLEARLINE 1
SELECTCASE RESULT
	CASE 1 TO 20
		CALL REPLACE_EQUIP,E_SHOCK,RESULT
	CASE 201
		IF LOCAL:1 > 20
			LOCAL:1 -= 20
			CLEARLINE 34
			GOTO E_001
		ELSE
		ENDIF
	CASE 202
		IF LOCAL:1 < 181 && LIST_E:0 == 20
			LOCAL:1 += 20
			CLEARLINE 34
			GOTO E_001
		ELSE
		ENDIF
	CASE 300
		CALL REMOVE_EQUIP,E_SHOCK
		GOTO E_001
	CASE 0
		CALL PCSHOW,202
	CASEELSE
ENDSELECT
CLEARLINE 34
;返回人物装备面板
CALL PCSHOW,202









;#####更换装备:更换#####
;ARG:1=对应装备槽,ARG:2=按钮编号
@REPLACE_EQUIP,ARG:1,ARG:2

;#####更换装备:取下#####
;同上
@REMOVE_EQUIP,ARG:1
SIF EQUIP:(ARG:1) == 0
	RETURN
IF EQUIP:(ARG:1) > 0
	CALL ITEM_ADD,ITEM_OWN:(EQUIP:(ARG:1)):1,1
	EQUIP:(ARG:1) = 0
ELSE
ENDIF

;#####物品添加，ARG为装备编号，ARG:1为增加物品数量#####
@ITEM_ADD,ARG,ARG:1
CALL ITEM_SORT
LOCAL = 0
;检索已有装备编号
CALL CHECK_ITEM_ID,ARG
LOCAL = RESULT
;若背包已存在该编号的物品(LOCAL为物品所在物品栏格子)
IF LOCAL > 0
	ITEM_OWN:0:0 += ARG:1
	ITEM_OWN:LOCAL:1 = ARG
	ITEM_OWN:LOCAL:2 += ARG:1
;若背包没有该编号的物品	
ELSEIF LOCAL == 0
	PACK_ID += 1
	ITEM_OWN:LOCAL:2 = 0
	ITEM_OWN:0:0 += ARG:1
	ITEM_OWN:PACK_ID:1 = ARG
	ITEM_OWN:PACK_ID:2 += ARG:1
ELSE
ENDIF

;#####物品删除，ARG为背包id，ARG:1为删除物品数量#####
@ITEM_DEL,ARG,ARG:1


;#####物品栏整理,清除物品栏数量为0的物品id#####
@ITEM_SORT









;#####检索物品格子,ARG为物品编号#####
@CHECK_ITEM_ID,ARG
;检测第LOCAL个物品栏
FOR LOCAL,0,PACK_ID+1
	IF ITEM_OWN:LOCAL:1 == ARG && ITEM_OWN:LOCAL:2 > 0
		RETURN LOCAL
		BREAK
	ELSE
		RETURN 0
	ENDIF
NEXT
	

	